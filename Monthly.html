<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Monthly Solar Production</title>
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
<style>
body {
  font-family: Arial, sans-serif;
  background: #f5f5f5;
  margin: 0;
  padding: 0;
  transition: background 0.3s, color 0.3s;
}
header {
  background: #2c3e50;
  color: #fff;
  padding: 15px 20px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.header-left {
  display: flex;
  flex-direction: column;
  justify-content: center;
  gap: 5px;
}
.header-left a {
  color:white;
  text-decoration:none;
  font-size:1em;
  padding: 2px 0;
}
.header-center {
  text-align: center;
  flex-grow: 1;
}
.header-right {
  display: flex;
  justify-content: flex-end;
  align-items: center;
}
canvas {
  background: #fff;
  border-radius: 10px;
  padding: 15px;
  transition: background 0.3s;
  width: 100% !important;
  height: 100% !important;
}

/* Dark Mode */
body.dark-mode { background: #1e1e1e; color: #eee; }
body.dark-mode header { background: #111; color: #eee; }
body.dark-mode canvas { background: #2a2a2a; }

/* Dark mode toggle button */
#darkModeToggle { font-size: 1.3em; background: none; border: none; cursor: pointer; }
</style>
</head>

<body class="dark-mode">

<header>
  <div class="header-left">
    <a href="index.html">🏠 Dashboard</a>
    <a href="top10.html">🏆 Top 10</a>
    <a href="monthly.html">📅 Monthly</a>
  </div>
  <div class="header-center">
    <h1>Monthly Solar Production</h1>
  </div>
  <div class="header-right">
    <button id="darkModeToggle">☀️</button>
  </div>
</header>

<main style="padding:20px; max-width:1200px; margin:auto;">
  <div style="height:500px;"> <!-- increased height -->
    <canvas id="monthlyChart"></canvas>
  </div>
</main>

<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
<script>
// Dark mode from localStorage
if(localStorage.getItem("darkMode") === "disabled") {
  document.body.classList.remove("dark-mode");
  document.getElementById("darkModeToggle").textContent = "🌙";
} else {
  document.getElementById("darkModeToggle").textContent = "☀️";
}

// CSV data
const rawData = `
20250702,291,0,577,18:37,Cloudy
20250703,33626,15500,4853,13:29,Partly Cloudy
20250704,35737,14900,5415,13:32,Partly Cloudy
20250705,18870,8100,4463,13:38,Rainy
20250706,20006,4200,5044,12:31,Partly Cloudy
20250707,25658,7400,5989,14:02,Partly Cloudy
20250708,37780,17800,5372,11:11,Sunny
20250709,34654,13200,5962,13:30,Partly Cloudy
20250710,36394,16200,4359,12:26,Partly Cloudy
20250711,36446,14400,4244,11:34,Partly Cloudy
20250712,36147,12800,4300,11:30,Partly Cloudy
20250713,28394,3300,4901,14:12,Partly Cloudy
20250714,33121,11000,5641,12:41,Partly Cloudy
20250715,31809,9900,5453,12:13,Partly Cloudy
20250716,35773,8100,5685,12:28,Partly Cloudy
20250717,17364,6700,4615,10:49,Rainy
20250718,32937,10800,5583,11:20,Partly Cloudy
20250719,11048,1800,4861,14:52,Cloudy
20250720,20234,13200,5314,14:50,Partly Cloudy
20250721,27296,12500,5681,11:18,Partly Cloudy
20250722,21117,6400,6101,11:27,Cloudy
20250723,16972,6900,3755,09:59,Rainy
20250724,12494,3900,3593,11:25,Cloudy
20250725,30961,19600,4888,12:26,Partly Cloudy
20250726,20433,8300,4595,15:31,Partly Cloudy
20250727,18261,13400,5018,13:52,Cloudy
20250728,33654,14800,5881,14:07,Partly Cloudy
20250729,15511,200,4001,12:44,Rainy
20250730,19034,7700,5185,11:11,Cloudy
20250731,13691,100,5251,13:13,Cloudy
20250801,20828,5600,5534,12:02,Cloudy
20250802,21967,7400,4393,10:34,Cloudy
20250803,23685,5700,4973,10:53,Cloudy
20250804,15341,100,2885,12:10,Cloudy
20250805,30710,12800,5197,13:30,Partly Cloudy
20250806,37308,26100,4761,13:27,Partly Cloudy
20250807,23584,9400,5443,12:26,Partly Cloudy
20250808,33645,22500,5241,14:17,Partly Cloudy
20250809,42103,14200,8600,13:09,Sunny
20250810,54640,30800,7734,13:04,Sunny
20250811,53647,31200,6829,11:52,Sunny
20250812,52670,29600,6749,12:25,Sunny
20250813,22965,200,5985,14:44,Cloudy
20250814,35556,17900,8080,13:35,Partly Cloudy
20250815,50293,20900,6776,12:12,Sunny
20250816,10421,2000,1867,13:52,Cloudy
20250817,52312,21700,6934,12:01,Sunny
20250818,16978,5200,5236,11:06,Cloudy
20250819,33255,8500,6981,11:19,Partly Cloudy
`;

const dataRows = rawData.trim().split("\n").map(r=>r.split(","));

// Monthly totals
const monthlyGenerated = {};
dataRows.forEach(r=>{
  const key = `${r[0].slice(0,4)}-${r[0].slice(4,6)}`;
  const generated = Number(r[1])/1000;
  if(!monthlyGenerated[key]) monthlyGenerated[key] = 0;
  monthlyGenerated[key] += generated;
});

// Chart function
const ctx = document.getElementById('monthlyChart').getContext('2d');
function createMonthlyChart(isDark){
  const months = Object.keys(monthlyGenerated);
  months.sort((a,b)=> new Date(a+"-01") - new Date(b+"-01"));
  const values = months.map(m => monthlyGenerated[m]);
  const monthNames = ["January","February","March","April","May","June",
                      "July","August","September","October","November","December"];
  const labels = months.map(m => monthNames[Number(m.split("-")[1])-1]);

  // Gradient for bars
  const gradient = ctx.createLinearGradient(0,0,0,250);
  if(isDark){
    gradient.addColorStop(0, 'rgba(255, 205, 86, 1)');
    gradient.addColorStop(1, 'rgba(255, 205, 86, 0.5)');
  } else {
    gradient.addColorStop(0, 'rgba(255, 159, 64, 1)');
    gradient.addColorStop(1, 'rgba(255, 159, 64, 0.5)');
  }

  return new Chart(ctx,{
    type:'bar',
    data:{
      labels: labels,
      datasets:[{
        label:'Generated (kWh)',
        data: values,
        backgroundColor: gradient,
        borderRadius: 12,
        hoverBackgroundColor: isDark ? 'rgba(255, 205, 86, 0.9)' : 'rgba(255, 159, 64, 0.9)',
        borderWidth:1,
        barPercentage: 0.7,
        categoryPercentage: 0.6
      }]
    },
    options:{
      responsive:true,
      maintainAspectRatio:false,
      plugins:{
        legend:{ labels:{ color:isDark?'#eee':'#000', font:{ size:16 } } }, // larger legend
        title:{ display:true, text:'Monthly Generated kWh', color:isDark?'#eee':'#000', font:{ size:24 } }, // larger title
        datalabels:{
          color:isDark?'#eee':'#000',
          anchor:'end',
          align:'end',
          font:{ weight:'bold', size:16 }, // larger data labels
          formatter: v => v.toFixed(2)+' kWh'
        }
      },
      scales:{
        x:{ 
          ticks:{ color:isDark?'#eee':'#000', padding:10, font:{ size:16 } },
          grid:{ color:isDark?'rgba(255,255,255,0.08)':'rgba(0,0,0,0.08)' }
        },
        y:{ 
          ticks:{ color:isDark?'#eee':'#000', padding:10, font:{ size:16 } },
          grid:{ color:isDark?'rgba(255,255,255,0.08)':'rgba(0,0,0,0.08)' }
        }
      }
    },
    plugins:[
      ChartDataLabels,
      { // subtle shadow behind bars
        id: 'barShadow',
        beforeDraw(chart) {
          const ctx = chart.ctx;
          chart.data.datasets.forEach((dataset, i) => {
            chart.getDatasetMeta(i).data.forEach(bar => {
              ctx.save();
              ctx.shadowColor = 'rgba(0,0,0,0.25)';
              ctx.shadowBlur = 6;
              ctx.shadowOffsetX = 2;
              ctx.shadowOffsetY = 2;
              ctx.fillStyle = bar.options.backgroundColor;
              ctx.fillRect(bar.x - bar.width/2, bar.y, bar.width, chart.chartArea.bottom - bar.y);
              ctx.restore();
            });
          });
        }
      }
    ]
  });
}

let monthlyChart = createMonthlyChart(document.body.classList.contains('dark-mode'));

// Dark mode toggle
const toggle = document.getElementById("darkModeToggle");
toggle.addEventListener("click", ()=>{
  document.body.classList.toggle("dark-mode");
  const isDark = document.body.classList.contains("dark-mode");
  localStorage.setItem("darkMode", isDark?"enabled":"disabled");
  toggle.textContent = isDark?"☀️":"🌙";
  monthlyChart.destroy();
  monthlyChart = createMonthlyChart(isDark);
});
</script>
</body>
</html>
