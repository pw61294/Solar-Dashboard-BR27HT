<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Paul's Solar Production Dashboard</title>
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f5f5;
      margin: 0;
      padding: 0;
    }
    header {
      background: #2c3e50;
      color: #fff;
      padding: 15px;
      text-align: center;
    }
    main {
      padding: 20px;
      max-width: 1200px;
      margin: auto;
    }
    .summary {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin-bottom: 20px;
    }
    .summary-card {
      flex: 1 1 calc(25% - 15px);
      background: #fff;
      border-radius: 10px;
      padding: 15px;
      text-align: center;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .summary-card h2 {
      margin: 0;
      font-size: 1.5em;
      color: #2c3e50;
    }
    .summary-card p {
      margin: 5px 0 0;
      font-size: 0.9em;
      color: #555;
    }
    canvas {
      background: #fff;
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 30px;
    }
    table {
      background: #fff;
      border-radius: 10px;
      overflow: hidden;
    }
  </style>
</head>
<body>
<header>
  <h1>Paul's Solar Production Dashboard</h1>
  <p>Daily Solar Output Overview</p>
</header>
<main>
  <div class="summary">
    <div class="summary-card">
      <h2 id="totalExport">0 kWh</h2>
      <p>Total Export</p>
    </div>
    <div class="summary-card">
      <h2 id="totalOutput">0 kWh</h2>
      <p>Total Output</p>
    </div>
    <div class="summary-card">
      <h2 id="avgOutput">0 kWh</h2>
      <p>Average Daily Output</p>
    </div>
    <div class="summary-card">
      <h2 id="maxDay">-</h2>
      <p>Highest Output Day</p>
    </div>
    <div class="summary-card">
      <h2 id="maxBattery">-</h2>
      <p>Highest Export Day</p>
    </div>
  </div>

  <canvas id="solarChart" height="100"></canvas>
  <table id="solarTable" class="display" style="width:100%">
    <thead>
      <tr>
        <th>Date</th>
        <th>Generated kWh</th>
        <th>Exported kWh</th>
        <th>Peak Watts</th>
        <th>Peak Time</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</main>

<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const rawData = `
20250702,291,0,577,18:37
20250703,33626,15500,4853,13:29
20250704,35737,14900,5415,13:32
20250705,18870,8100,4463,13:38
20250706,20006,4200,5044,12:31
20250707,25658,7400,5989,14:02
20250708,37780,17800,5372,11:11
20250709,34654,13200,5962,13:30
20250710,36394,16200,4359,12:26
20250711,36446,14400,4244,11:34
20250712,36147,12800,4300,11:30
20250713,28394,3300,4901,14:12
20250714,33121,11000,5641,12:41
20250715,31809,9900,5453,12:13
20250716,35773,8100,5685,12:28
20250717,17364,6700,4615,10:49
20250718,32937,10800,5583,11:20
20250719,11048,1800,4861,14:52
20250720,20234,13200,5314,14:50
20250721,27296,12500,5681,11:18
20250722,21117,6400,6101,11:27
20250723,16972,6900,3755,09:59
20250724,12494,3900,3593,11:25
20250725,30961,19600,4888,12:26
20250726,20433,8300,4595,15:31
20250727,18261,13400,5018,13:52
20250728,33654,14800,5881,14:07
20250729,15511,200,4001,12:44
20250730,19034,7700,5185,11:11
20250731,13691,100,5251,13:13
20250801,20828,5600,5534,12:02
20250802,21967,7400,4393,10:34
20250803,23685,5700,4973,10:53
20250804,15341,100,2885,12:10
20250805,30710,12800,5197,13:30
20250806,37308,26100,4761,13:27
20250807,23584,9400,5443,12:26
20250808,33645,22500,5241,14:17
20250809,42103,14200,8600,13:09
20250810,54640,30800,7734,13:04
20250811,53647,31200,6829,11:52
20250812,52670,29600,6749,12:25
20250813,22965,200,5985,14:44
20250814,35556,17900,8080,13:35
20250815,50293,20900,6776,12:12
`;

const dataRows = rawData.trim().split("\n").map(row => row.split(","));
const chartLabels = [];
const mainData = [];
const batteryData = [];

let totalMain = 0;
let totalExport = 0;
let maxMain = { value: 0, date: "" };
let maxBattery = { value: 0, date: "" };

dataRows.forEach(r => {
  const y = r[0].slice(0,4), m = r[0].slice(4,6), d = r[0].slice(6,8);
  const sortKey = `${y}${m}${d}`;              // e.g. 20250815  (perfect for sorting)
  const displayDate = `${y}-${m}-${d}`;        // what the user sees

  const main = Number(r[1]) / 1000;
  const battery = Number(r[2]) / 1000;

  chartLabels.push(displayDate);
  mainData.push(main);
  batteryData.push(battery);

  totalMain += main;
  totalExport += battery;

  if (main > maxMain.value) maxMain = { value: main, date: displayDate };
  if (battery > maxBattery.value) maxBattery = { value: battery, date: displayDate };

  $('#solarTable tbody').append(`
    <tr>
      <td data-order="${sortKey}">${displayDate}</td>
      <td>${main.toFixed(2)}</td>
      <td>${battery.toFixed(2)}</td>
      <td>${Number(r[3]).toLocaleString()}</td>
      <td>${r[4]}</td>
    </tr>
  `);
});


// Update summary cards
$('#totalOutput').text(`${totalMain.toFixed(2)} kWh`);
$('#totalExport').html(`
  ${totalExport.toFixed(2)} kWh<br>
  (Â£${earnings.toFixed(2)})
`);
$('#avgOutput').text(`${(totalMain / dataRows.length).toFixed(2)} kWh`);
$('#maxDay').text(`${maxMain.value.toFixed(2)} kWh (${maxMain.date})`);
$('#maxBattery').text(`${maxBattery.value.toFixed(2)} kWh (${maxBattery.date})`);

// Initialize DataTable with newest date first
$('#solarTable').DataTable({
  order: [[0, 'desc']]
});

new Chart(document.getElementById('solarChart'), {
  type: 'line',
  data: {
    labels: chartLabels,
    datasets: [
      {
        label: 'Generated (kWh)',
        data: mainData,
        borderColor: 'rgba(255, 99, 132, 1)',
        backgroundColor: 'rgba(255, 99, 132, 0.2)',
        fill: true,
        tension: 0.3
      },
      {
        label: 'Exported (kWh)',
        data: batteryData,
        borderColor: 'rgba(54, 162, 235, 1)',
        backgroundColor: 'rgba(54, 162, 235, 0.2)',
        fill: true,
        tension: 0.3
      }
    ]
  },
  options: {
    responsive: true,
    plugins: {
      legend: { position: 'top' },
      title: {
        display: true,
        text: 'Daily Solar Production'
      }
    }
  }
});
</script>
</body>
</html>
