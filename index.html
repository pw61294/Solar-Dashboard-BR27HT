<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Paul's Solar Production Dashboard</title>
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
<style>
body {
  font-family: Arial, sans-serif;
  background: #232832;
  color: #eee;
  margin: 0;
  padding: 0;
  transition: background 0.3s, color 0.3s;
}
header {
  background: #16181d;
  color: #eee;
  padding: 15px 20px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.header-center {
  flex-grow: 1;
  text-align: center;
}
.header-right {
  display: flex;
  align-items: center;
  justify-content: flex-end;
}
.header-left {
  display: flex;
  flex-direction: column;
  justify-content: center;
  gap: 10px;
  padding-top: 10px;
}
.header-left a {
  color:white;
  font-weight: 500;
  text-decoration: none; /* removes underline */
  margin-right: 20px;
  transition: color 0.3s;
}
header button {
  cursor: pointer;
  font-size: 1.2em;
  background: none;
  border: none;
  padding: 0;
}
main {
  padding: 20px;
  max-width: 1200px;
  margin: auto;
}
.summary {
  display: flex;
  flex-wrap: wrap;
  gap: 15px;
  margin-bottom: 20px;
}
.summary-card {
  flex: 1 1 calc(25% - 15px);
  background: #16181d;
  border-radius: 10px;
  padding: 15px;
  text-align: center;
  box-shadow: 0 2px 5px rgba(255,255,255,0.1);
  transition: background 0.3s, color 0.3s;
}
.summary-card h2 { margin: 0; font-size: 1.5em; color: #eee; }
.summary-card p { margin: 5px 0 0; font-size: 0.9em; color: #bbb; }
canvas {
  background: #16181d;
  border-radius: 10px;
  padding: 15px;
  margin-bottom: 30px;
  transition: background 0.3s;
}
table {
  background: #16181d;
  border-radius: 10px;
  overflow: hidden;
  color: #eee;
  transition: background 0.3s, color 0.3s;
}
#solarTable.dark-mode th,
#solarTable.dark-mode td { color: #eee; border-color: #444; }
.dataTables_wrapper .dataTables_paginate .paginate_button { color: #eee !important; }

#darkModeToggle { font-size: 1.3em; background: none; border: none; cursor: pointer; padding: 0; margin: 0; }
#darkModeToggle:focus { outline: none; }

@media(max-width:800px) {
  .summary-card { flex: 1 1 100%; }
}
</style>
</head>
<body class="dark-mode">

<header>
  <div class="header-left">
    <a href="index.html">üè† Dashboard</a>
    <a href="top10.html">üèÜ Top 10</a>
    <a href="monthly.html">üìÖ Monthly</a>
    <a href="peakwatts.html">‚ö° Peak Watts</a>
  </div>
  <div class="header-center">
    <h1>Paul's Solar Production Dashboard</h1>
    <p>Daily Solar Production Overview</p>
  </div>
  <div class="header-right">
  </div>
</header>

<main>
<div class="summary">
  <div class="summary-card"><h2 id="totalOutput">0 kWh</h2><p>Total Production</p></div>
  <div class="summary-card"><h2 id="maxDay">-</h2><p>Highest Production Day</p></div>
  <div class="summary-card"><h2 id="maxBattery">-</h2><p>Highest Export Day</p></div>
  <div class="summary-card"><h2 id="avgOutput">0 kWh</h2><p>Average Daily Output</p></div>
  <div class="summary-card"><h2 id="monthlyEarnings">¬£0.00</h2><p>Monthly Earnings</p></div>
  <div class="summary-card"><h2 id="totalExport">0 kWh</h2><p>Total Export</p></div>
</div>

<canvas id="solarChart" height="100"></canvas>
<table id="solarTable" class="display dark-mode" style="width:100%">
  <thead>
    <tr>
      <th>Date</th>
      <th>Generated kWh</th>
      <th>Exported kWh</th>
      <th>Peak Watts</th>
      <th>Peak Time</th>
      <th>Weather</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>
</main>

<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const rawData = `
20250702,291,0,577,18:37,Cloudy
20250703,33626,15500,4853,13:29,Partly Cloudy
20250704,35737,14900,5415,13:32,Partly Cloudy
20250705,18870,8100,4463,13:38,Rainy
20250706,20006,4200,5044,12:31,Partly Cloudy
20250707,25658,7400,5989,14:02,Partly Cloudy
20250708,37780,17800,5372,11:11,Sunny
20250709,34654,13200,5962,13:30,Partly Cloudy
20250710,36394,16200,4359,12:26,Partly Cloudy
20250711,36446,14400,4244,11:34,Partly Cloudy
20250712,36147,12800,4300,11:30,Partly Cloudy
20250713,28394,3300,4901,14:12,Partly Cloudy
20250714,33121,11000,5641,12:41,Partly Cloudy
20250715,31809,9900,5453,12:13,Partly Cloudy
20250716,35773,8100,5685,12:28,Partly Cloudy
20250717,17364,6700,4615,10:49,Rainy
20250718,32937,10800,5583,11:20,Partly Cloudy
20250719,11048,1800,4861,14:52,Cloudy
20250720,20234,13200,5314,14:50,Partly Cloudy
20250721,27296,12500,5681,11:18,Partly Cloudy
20250722,21117,6400,6101,11:27,Cloudy
20250723,16972,6900,3755,09:59,Rainy
20250724,12494,3900,3593,11:25,Cloudy
20250725,30961,19600,4888,12:26,Partly Cloudy
20250726,20433,8300,4595,15:31,Partly Cloudy
20250727,18261,13400,5018,13:52,Cloudy
20250728,33654,14800,5881,14:07,Partly Cloudy
20250729,15511,200,4001,12:44,Rainy
20250730,19034,7700,5185,11:11,Cloudy
20250731,13691,100,5251,13:13,Cloudy
20250801,20828,5600,5534,12:02,Cloudy
20250802,21967,7400,4393,10:34,Cloudy
20250803,23685,5700,4973,10:53,Cloudy
20250804,15341,100,2885,12:10,Cloudy
20250805,30710,12800,5197,13:30,Partly Cloudy
20250806,37308,26100,4761,13:27,Partly Cloudy
20250807,23584,9400,5443,12:26,Partly Cloudy
20250808,33645,22500,5241,14:17,Partly Cloudy
20250809,42103,14200,8600,13:09,Sunny
20250810,54640,30800,7734,13:04,Sunny
20250811,53647,31200,6829,11:52,Sunny
20250812,52670,29600,6749,12:25,Sunny
20250813,22965,200,5985,14:44,Cloudy
20250814,35556,17900,8080,13:35,Partly Cloudy
20250815,50293,20900,6776,12:12,Sunny
20250816,10421,2000,1867,13:52,Cloudy
20250817,52312,21700,6934,12:01,Sunny
20250818,16978,5200,5236,11:06,Cloudy
20250819,33255,8500,6981,11:19,Partly Cloudy
20250820,24105,9100,7561,14:00,Cloudy
20250821,19737,1900,4294,14:28,Cloudy
20250822,39243,6300,7823,11:15,Partly Cloudy
20250823,28462,7400,8155,13:11,Partly Cloudy
20250824,44424,14400,7928,13:15,Sunny
20250825,51219,15900,6685,12:05,Sunny
20250826,31960,7300,7602,13:50,Partly Cloudy
20250827,31190,15400,8274,12:01,Partly Cloudy
20250828,37594,10300,8779,11:40,Partly Cloudy
20250829,23434,9800,8431,14:13,Partly Cloudy
20250830,32720,9700,8664,13:51,Partly Cloudy
20250831,39794,18600,8793,11:51,Partly Cloudy
20250901,37828,7100,7897,11:49,Partly Cloudy
20250902,26021,8000,9948,13:02,Partly Cloudy
20250903,19196,3400,7622,11:11,Cloudy
20250904,30399,4200,8263,12:25,Partly Cloudy
20250905,38156,3600,7647,12:31,Partly Cloudy
20250906,39170,5900,8542,12:34,Partly Cloudy
20250907,38121,10300,7493,12:15,Partly Cloudy
20250908,42680,7100,7594,11:31,Partly Cloudy
20250909,41082,6900,7760,12:01,Partly Cloudy
20250910,21978,7900,8907,13:15,Cloudy
20250911,30443,2500,7311,13:16,Partly Cloudy
20250912,35188,3700,8084,13:02,Partly Cloudy
20250913,31342,6300,8660,12:39,Partly Cloudy
20250914,15416,1300,3591,11:16,Rainy
20250915,34870,6300,8254,11:45,Partly Cloudy
20250916,34566,4700,8269,11:56,Partly Cloudy
20250917,8607,1000,5663,12:43,Cloudy
20250918,17912,8500,7702,14:05,Cloudy
20250919,41673,27200,6249,11:42,Partly Cloudy
20250920,15151,5800,6916,12:16,Cloudy
20250921,28457,14000,8280,11:44,Cloudy
20250922,38539,21200,7320,12:17,Partly Cloudy
20250923,23098,6300,8482,11:53,Cloudy
20250924,28577,16900,7773,11:34,Cloudy
20250925,39389,20300,7319,11:35,Partly Cloudy
20250926,8124,2000,2533,13:25,Cloudy
20250927,23002,5200,6837,13:21,Partly Cloudy
20250928,8080,700,2365,08:48,Cloudy
20250929,30965,17100,6295,12:35,Partly Cloudy
20250930,36734,16700,5903,11:54,Sunny
20251001,11792,4100,2574,13:48,Cloudy
20251002,15896,1600,3655,11:02,Cloudy
20251003,4681,100,1190,12:19,Rainy

`;

const dataRows = rawData.trim().split("\n").map(r => r.split(","));
const chartLabels = [], mainData = [], batteryData = [];
let totalMain=0, totalExport=0, maxMain={value:0,date:""}, maxExport={value:0,date:""};

const weatherEmoji = { "Sunny":"‚òÄÔ∏è Sunny", "Cloudy":"‚òÅÔ∏è Cloudy", "Partly Cloudy":"‚õÖ Partly Cloudy", "Rainy":"üåßÔ∏è Rainy" };

dataRows.forEach(r=>{
  const y=r[0].slice(0,4), m=r[0].slice(4,6), d=r[0].slice(6,8);
  const sortKey=`${y}${m}${d}`, displayDate=`${y}-${m}-${d}`;
  const main=Number(r[1])/1000, battery=Number(r[2])/1000;

// Monthly Earnings Calculation
const monthlyTotals = {};
dataRows.forEach(r => {
  const yearMonth = r[0].slice(0,6); // e.g., "202507"
  const exportKWh = Number(r[2]) / 1000;
  if (!monthlyTotals[yearMonth]) monthlyTotals[yearMonth] = 0;
  monthlyTotals[yearMonth] += exportKWh;
});

// Get latest month
const latestMonth = Object.keys(monthlyTotals).sort().pop();
const latestEarnings = monthlyTotals[latestMonth] * 0.165;

$('#monthlyEarnings').html(`¬£${latestEarnings.toFixed(2)}<br><span style="font-size:0.8em; color:#bbb;">${latestMonth.slice(0,4)}-${latestMonth.slice(4,6)}</span>`);


  chartLabels.push(displayDate);
  mainData.push(main);
  batteryData.push(battery);

  totalMain+=main;
  totalExport+=battery;
  if(main>maxMain.value) maxMain={value:main,date:displayDate};
  if(battery>maxExport.value) maxExport={value:battery,date:displayDate};

  $('#solarTable tbody').append(`
    <tr>
      <td data-order="${sortKey}">${displayDate}</td>
      <td>${main.toFixed(2)}</td>
      <td>${battery.toFixed(2)}</td>
      <td>${Number(r[3]).toLocaleString()}</td>
      <td>${r[4]}</td>
      <td>${weatherEmoji[r[5]]||r[5]}</td>
    </tr>
  `);
});

// Summary cards
$('#totalOutput').text(`${(totalMain / 1000).toFixed(2)} MWh`);
$('#totalExport').html(`${totalExport.toFixed(2)} kWh<br><span style="font-size:0.8em; color:#bbb;">¬£${(totalExport*0.165).toFixed(2)}</span>`);
$('#avgOutput').html(`${(totalMain/dataRows.length).toFixed(2)} kWh<br><span style="font-size:0.8em; color:#bbb;">¬£${((totalExport/dataRows.length)*0.165).toFixed(2)} / day</span>`);
$('#maxDay').text(`${maxMain.value.toFixed(2)} kWh (${maxMain.date})`);
$('#maxBattery').text(`${maxExport.value.toFixed(2)} kWh (${maxExport.date})`);

// DataTable
const solarTable=$('#solarTable').DataTable({order:[[0,'desc']],responsive:true});

// Chart.js
const ctx=document.getElementById('solarChart').getContext('2d');
function createChart(isDark){
  return new Chart(ctx,{
    type:'line',
    data:{labels:chartLabels,datasets:[
      {label:'Generated (kWh)',data:mainData,borderColor:'rgba(255,99,132,1)',backgroundColor:'rgba(255,99,132,0.2)',fill:true,tension:0.3},
      {label:'Exported (kWh)',data:batteryData,borderColor:'rgba(54,162,235,1)',backgroundColor:'rgba(54,162,235,0.2)',fill:true,tension:0.3}
    ]},
    options:{
      responsive:true,
      plugins:{legend:{labels:{color:isDark?'#eee':'#000'}},title:{display:true,text:'Daily Solar Production',color:isDark?'#eee':'#000'}},
      scales:{x:{ticks:{color:isDark?'#eee':'#000'}},y:{ticks:{color:isDark?'#eee':'#000'}}}
    }
  });
}
let solarChart=createChart(true);

// Dark Mode Toggle
const toggle=document.getElementById("darkModeToggle");
toggle.addEventListener("click",()=>{
  document.body.classList.toggle("dark-mode");
  const isDark=document.body.classList.contains("dark-mode");
  localStorage.setItem("darkMode",isDark?"enabled":"disabled");
  toggle.textContent=isDark?"‚òÄÔ∏è":"üåô";

  solarChart.destroy();
  solarChart=createChart(isDark);

  if(isDark){$('#solarTable').addClass('dark-mode');}else{$('#solarTable').removeClass('dark-mode');}
});
</script>
</body>
</html>
