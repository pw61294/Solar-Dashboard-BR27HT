<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Top 10 Solar Production Days</title>
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f5f5f5;
    margin: 0;
    padding: 0;
    transition: background 0.3s, color 0.3s;
  }
  header {
    background: #2c3e50;
    color: #fff;
    padding: 15px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  header a { color: #fff; text-decoration: none; }
  main {
    max-width: 1000px;
    margin: auto;
    padding: 20px;
  }
  table {
    background: #fff;
    border-radius: 10px;
    overflow: hidden;
    margin-top: 20px;
  }
  canvas {
    background: #fff;
    border-radius: 10px;
    padding: 15px;
  }
  /* Dark mode */
  body.dark-mode { background: #1e1e1e; color: #eee; }
  body.dark-mode header { background: #111; color: #eee; }
  body.dark-mode table, body.dark-mode canvas { background: #2a2a2a; color: #eee; }
  #darkModeToggle { background: none; border: none; font-size: 1.2rem; cursor: pointer; padding: 0; margin: 0; }
  #darkModeToggle:focus { outline: none; }
</style>
</head>
<body>
<header>
  <a href="index.html">‚¨Ö Back to Dashboard</a>
  <h2>üèÜ Top 10 Solar Production Days</h2>
  <button id="darkModeToggle">üåô</button>
</header>

<main>
  <canvas id="top10Chart" height="120"></canvas>

  <table id="top10Table" class="display" style="width:100%">
    <thead>
      <tr>
        <th>Date</th>
        <th>Generated (kWh)</th>
        <th>Exported (kWh)</th>
        <th>Peak Watts</th>
        <th>Peak Time</th>
        <th>Weather</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</main>

<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const rawData = `
20250702,291,0,577,18:37,Cloudy
20250703,33626,15500,4853,13:29,Partly Cloudy
20250704,35737,14900,5415,13:32,Partly Cloudy
20250705,18870,8100,4463,13:38,Rainy
20250706,20006,4200,5044,12:31,Partly Cloudy
20250707,25658,7400,5989,14:02,Partly Cloudy
20250708,37780,17800,5372,11:11,Sunny
20250709,34654,13200,5962,13:30,Partly Cloudy
20250710,36394,16200,4359,12:26,Partly Cloudy
20250711,36446,14400,4244,11:34,Partly Cloudy
20250712,36147,12800,4300,11:30,Partly Cloudy
20250713,28394,3300,4901,14:12,Partly Cloudy
20250714,33121,11000,5641,12:41,Partly Cloudy
20250715,31809,9900,5453,12:13,Partly Cloudy
20250716,35773,8100,5685,12:28,Partly Cloudy
20250717,17364,6700,4615,10:49,Rainy
20250718,32937,10800,5583,11:20,Partly Cloudy
20250719,11048,1800,4861,14:52,Cloudy
20250720,20234,13200,5314,14:50,Partly Cloudy
20250721,27296,12500,5681,11:18,Partly Cloudy
20250722,21117,6400,6101,11:27,Cloudy
20250723,16972,6900,3755,09:59,Rainy
20250724,12494,3900,3593,11:25,Cloudy
20250725,30961,19600,4888,12:26,Partly Cloudy
20250726,20433,8300,4595,15:31,Partly Cloudy
20250727,18261,13400,5018,13:52,Cloudy
20250728,33654,14800,5881,14:07,Partly Cloudy
20250729,15511,200,4001,12:44,Rainy
20250730,19034,7700,5185,11:11,Cloudy
20250731,13691,100,5251,13:13,Cloudy
20250801,20828,5600,5534,12:02,Cloudy
20250802,21967,7400,4393,10:34,Cloudy
20250803,23685,5700,4973,10:53,Cloudy
20250804,15341,100,2885,12:10,Cloudy
20250805,30710,12800,5197,13:30,Partly Cloudy
20250806,37308,26100,4761,13:27,Partly Cloudy
20250807,23584,9400,5443,12:26,Partly Cloudy
20250808,33645,22500,5241,14:17,Partly Cloudy
20250809,42103,14200,8600,13:09,Sunny
20250810,54640,30800,7734,13:04,Sunny
20250811,53647,31200,6829,11:52,Sunny
20250812,52670,29600,6749,12:25,Sunny
20250813,22965,200,5985,14:44,Cloudy
20250814,35556,17900,8080,13:35,Partly Cloudy
20250815,50293,20900,6776,12:12,Sunny
20250816,10421,2000,1867,13:52,Cloudy
20250817,52312,21700,6934,12:01,Sunny
`;

const weatherEmoji = {
  "Sunny": "‚òÄÔ∏è Sunny",
  "Cloudy": "‚òÅÔ∏è Cloudy",
  "Partly Cloudy": "‚õÖ Partly Cloudy",
  "Rainy": "üåßÔ∏è Rainy"
};

$(document).ready(function(){
  const dataRows = rawData.trim().split("\n").map(r => r.split(",")).map(r => ({
    date: `${r[0].slice(0,4)}-${r[0].slice(4,6)}-${r[0].slice(6,8)}`,
    generated: Number(r[1])/1000,
    exported: Number(r[2])/1000,
    peak: Number(r[3]),
    time: r[4],
    weather: r[5]
  }));

  const top10 = dataRows.sort((a,b)=>b.generated-a.generated).slice(0,10);

  top10.forEach(r => {
    $('#top10Table tbody').append(`
      <tr>
        <td>${r.date}</td>
        <td>${r.generated.toFixed(2)}</td>
        <td>${r.exported.toFixed(2)}</td>
        <td>${r.peak.toLocaleString()}</td>
        <td>${r.time}</td>
        <td>${weatherEmoji[r.weather] || r.weather}</td>
      </tr>
    `);
  });

  const table = $('#top10Table').DataTable({ order: [[1,'desc']] });

  let chart;
  function drawChart(isDark){
    if(chart) chart.destroy();
    chart = new Chart(document.getElementById("top10Chart"), {
      type: 'bar',
      data: {
        labels: top10.map(r=>r.date),
        datasets:[{
          label:'Generated (kWh)',
          data: top10.map(r=>r.generated),
          backgroundColor:'rgba(255,159,64,0.7)',
          borderColor:'rgba(255,159,64,1)',
          borderWidth:1
        }]
      },
      options:{
        responsive:true,
        plugins:{
          legend:{ labels:{ color:isDark?'#eee':'#333' } },
          title:{ display:true, text:'Top 10 Best Production Days', color:isDark?'#eee':'#333' }
        },
        scales:{
          x:{ ticks:{ color:isDark?'#eee':'#333' } },
          y:{ ticks:{ color:isDark?'#eee':'#333' } }
        }
      }
    });
  }

  const toggle = document.getElementById("darkModeToggle");
  function applyMode(){
    const isDark = document.body.classList.contains("dark-mode");
    toggle.textContent = isDark?"‚òÄÔ∏è":"üåô";
    drawChart(isDark);
    // Table dark mode colors
    if(isDark){ $('#top10Table').addClass('dark-mode'); }else{ $('#top10Table').removeClass('dark-mode'); }
  }
  if(localStorage.getItem("darkMode")==="enabled"){ document.body.classList.add("dark-mode"); }
  applyMode();

  toggle.addEventListener("click",()=>{
    document.body.classList.toggle("dark-mode");
    localStorage.setItem("darkMode", document.body.classList.contains("dark-mode")?"enabled":"disabled");
    applyMode();
  });
});
</script>
</body>
</html>
